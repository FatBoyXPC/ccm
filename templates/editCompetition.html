<template name="editCompetition">

  <div class="container-fluid">

    <form class="form-horizontal" role="form">
      <div class="form-group">
        <label for="inputCompetitionName" class="col-sm-3 col-lg-2 control-label">Competition Name</label>
        <div class="col-sm-9 col-lg-10">
          <input type="text" class="form-control" id="inputCompetitionName" name="competitionName" value="{{competition 'competitionName'}}" />
        </div>
      </div>
      <div class="form-group">
        <label for="inputWcaCompetitionId" class="col-sm-3 col-lg-2 control-label">WCA Competition ID</label>
        <div class="col-sm-9 col-lg-10">
          <input type="text" class="form-control" id="inputWcaCompetitionId" name="wcaCompetitionId" value="{{competition 'wcaCompetitionId'}}" disabled="{{#unless isSiteAdmin}}disabled{{/unless}}" />
        </div>
      </div>
      <div class="form-group">
        <label class="col-sm-3 col-lg-2 control-label">Visibility</label>
        <div class="col-sm-9 col-lg-10">
          {{#if isSiteAdmin}}
            <div id="toggleCompetitionListed" class="btn-group">
              <button type="button" class="btn btn-default {{#if competition 'listed'}}active{{/if}}">
                Listed
              </button>
              <button type="button" class="btn btn-default {{#unless competition 'listed'}}active{{/unless}}">
                Hidden
              </button>
            </div>
          {{else}}
            <p class="form-control-static">
              {{#if competition "listed"}}
                Listed
              {{else}}
                Hidden
              {{/if}}
            </p>
          {{/if}}
        </div>
      </div>

      <div class="form-group">
        <label for="inputCompetitionStart" class="col-sm-3 col-lg-2 control-label">When</label>
        <div class="col-sm-9 col-lg-10">
          <p class="form-control-static">
            <a href="{{pathFor 'editSchedule' competitionUrlId=competitionUrlId}}">
              {{#unless competitionStartDateMoment}}
                Unscheduled
              {{else}}
                {{competitionStartDateMoment.fromNow}}
                ({{formatMomentRange competitionStartDateMoment competitionEndDateMoment}})
              {{/unless}}
            </a>
          </p>
        </div>
      </div>

    </form>
    <p>
      <button type="button" class="btn btn-danger" data-toggle="modal" data-target="#modalConfirmDeleteCompetition">
        <span class="glyphicon glyphicon-trash"></span> Delete competition
      </button>
    </p>
    <div id="modalConfirmDeleteCompetition" class="modal fade">
      <div class="modal-dialog">
        <div class="modal-content">
          <div class="modal-header">
            <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Cancel</span></button>
            <h4 class="modal-title">Are you sure you want to delete this competiton?</h4>
          </div>
          <div class="modal-body">
            <p>Deleting this competition is permanent and irreversible.</p>
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-default" data-dismiss="modal">Cancel</button>
            <button type="button" class="btn btn-danger" name="buttonDeleteCompetition">
              <span class="glyphicon glyphicon-trash"></span> Delete competition
            </button>
          </div>
        </div><!-- /.modal-content -->
      </div><!-- /.modal-dialog -->
    </div><!-- /.modal -->


    <div class="row">
      <div id="organizersList" class="col-sm-6">
        {{#editCompetition_users competitionId=competitionId userIdsAtribute="organizers"}}
          Have complete control over a competition.
        {{/editCompetition_users}}
      </div>

      <div id="staffList" class="col-sm-6">
        {{#editCompetition_users competitionId=competitionId userIdsAtribute="staff"}}
          Can only enter times and view scrambles for ongoing rounds.
        {{/editCompetition_users}}
      </div>

    </div>

    <div id="editEventsList">
      <h2>
        Events
      </h2>

      <div class="row">
        {{#each events}}

          <div class="{{eventColumnsClasses}}">

            <div class="event panel panel-default">

              <div class="panel-heading">
                <h3 class="panel-title">
                  <a data-toggle="collapse" data-parent="#accordion" href="#collapse{{eventCode}}" class="collapsed">
                    <img class="img-thumbnail" src="{{eventIcon eventCode}}" alt="{{eventCode}}"><span>{{eventName eventCode}}</span>
                  </a>
                </h3>
              </div>
              <div id="collapse{{eventCode}}" class="panel-collapse collapse">
                <div class="panel-body">
                  <table class="table table-condensed">
                    <thead>
                      <tr>
                        <th>Round Name</th>
                        <th>Format</th>
                        <th>Progress</th>
                        <th class="text-center">#</th>
                        <th class="text-center">
                          <span class="glyphicon glyphicon-cog"></span>
                        </th>
                      </tr>
                    </thead>
                    <tbody>
                      {{#each rounds}}
                        <tr>

                          <td>{{roundName roundCode}}</td>

                          <td>
                            <div class="dropdown">
                              <button class="btn btn-default btn-xs dropdown-toggle" type="button" id="dropdownMenu1" data-toggle="dropdown">
                                {{formatShortName formatCode}}
                                <span class="caret"></span>
                              </button>
                              <ul class="dropdown-menu" role="menu" aria-labelledby="dropdownMenu1">
                                {{#each formats}}
                                  <li role="presentation">
                                    <a role="menuitem" tabindex="-1" href="#" data-format_code="{{this}}" data-round_id="{{../_id}}">{{formatName this}}</a>
                                  </li>
                                {{/each}}
                              </ul>
                            </div>
                          </td>

                          <td>
                            <div class="progress">
                              <div class="progress-bar {{#if roundComplete}}progress-bar-success{{else}}progress-bar-warning{{/if}} {{#if roundOpen}}progress-bar-striped active{{/if}}" role="progressbar" aria-valuenow="60" aria-valuemin="0" aria-valuemax="100" style="width: {{roundProgressPercentage}}%;">
                                {{roundProgressPercentage}}%
                              </div>
                            </div>
                          </td>

                          <td class="text-right">{{competitorCount}}</td>

                          <td class="text-center">
                            <div class="btn-group">
                              {{#if canOpenRound}}
                                <button type="button" name="buttonOpenRound"
                                        class="btn btn-default btn-xs btn-unlock"
                                        data-toggle="tooltip" data-placement="left" data-original-title="Click to open round" data-container="body">
                                  <i class="fa"></i>
                                </button>
                              {{/if}}
                              {{#if canCloseRound}}
                                <button type="button" name="buttonCloseRound"
                                        class="btn btn-default btn-xs btn-lock"
                                        data-toggle="tooltip" data-placement="left" data-original-title="Click to close round" data-container="body">
                                  <i class="fa"></i>
                                </button>
                              {{/if}}
                              {{#if canAdvanceRound}}
                                <button type="button" name="buttonAdvanceCompetitors"
                                        class="btn btn-default btn-xs"
                                        data-toggle="tooltip" data-placement="left" data-original-title="Click to advance competitors to next round" data-container="body">
                                  <i class="fa fa-step-forward"></i>
                                </button>
                              {{/if}}
                            </div> 
                          </td>

                        </tr>
                      {{/each}}
                    </tbody>
                    <tfoot>
                      <tr>
                        <td colspan="5">
                          <div class="btn-group btn-group-justified">
                            <div class="btn-group">
                              <button type="button" name="buttonRemoveRound"
                                      class="btn btn-default btn-xs"
                                      disabled="{{#unless canRemoveRound}}disabled{{/unless}}">
                                <span class="glyphicon glyphicon-minus"></span> Delete last round
                              </button>
                            </div>
                            <div class="btn-group">
                              <button type="button" name="buttonAddRound"
                                      class="btn btn-default btn-xs"
                                      disabled="{{#unless canAddRound}}disabled{{/unless}}">
                                <span class="glyphicon glyphicon-plus"></span> Add round
                              </button>
                            </div>
                          </div>
                        </td>
                      </tr>
                    </tfoot>
                  </table>
                </div>
              </div>

            </div>

          </div>

          {{#if clearfixVisibleClass}}
            <div class="clearfix {{clearfixVisibleClass}}"></div>
          {{/if}}

        {{/each}}
      </div>
    </div>

  </div>

</template>

<template name="editCompetition_userRow">
  {{profile.name}} ({{_id}})
  {{#if isMe}}
    <span class="label label-default">Me</span>
  {{/if}}
</template>

<template name="editCompetition_users">

  <div class="panel panel-default">

    <div class="panel-heading">
      <h3 class="panel-title text-capitalize">
        {{userIdsAtribute}}
      </h3>
      {{> UI.contentBlock}}
    </div>

    <ul class="list-group">
      {{#each users}}
        <li class="list-group-item">
          {{> editCompetition_userRow}}
          {{#unless isCurrentUser}}
            <button type="button" name="buttonRemoveUser" class="btn btn-default btn-xs pull-right">
              <span class="glyphicon glyphicon-remove"></span>
            </button>
          {{/unless}}
        </li>
      {{else}}
        <li class="list-group-item">
          No {{userIdsAtribute}} yet! Add some below.
        </li>
      {{/each}}

      <div class="panel-footer">
        <form class="form-horizontal" role="form">
          <div class="input-group">
            <input name="name" class="typeahead form-control" type="text" placeholder="Enter name">
            <span class="input-group-btn">
              <button type="submit" name="buttonAddUser" class="btn btn-default">
                <span class="glyphicon glyphicon-plus"></span>
              </button>
            </span>
          </div>
        </form>
      </div>

    </ul>
  </div>

</template>
